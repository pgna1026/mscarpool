<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마송고 카풀 서비스</title>
    <style>
        .hidden { display: none; }
    </style>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
</head>
<body>
    <h1>마송고 카풀 서비스</h1>

    <button id="hostButton">호스트</button>
    <div id="hostForm" class="hidden">
        <input type="text" id="roomName" placeholder="방 이름">
        <button id="createRoom">방 만들기</button>
    </div>

    <input type="text" id="searchInput" placeholder="방 이름 검색">
    <div id="roomLinks"></div>

    <script>
        // Firebase 초기화
        var firebaseConfig = {
            apiKey: "AIzaSyD440GeW-QjzwjkaA9fkZ8oMtWsV-aFoPk",
            authDomain: "mscarpool-5784e.firebaseapp.com",
            projectId: "mscarpool-5784e",
            storageBucket: "mscarpool-5784e.appspot.com",
            messagingSenderId: "268039699884",
            appId: "1:268039699884:web:e88c8dc7217fb3d7c80e09"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();

        document.addEventListener("DOMContentLoaded", function() {
            const hostButton = document.getElementById('hostButton');
            const hostForm = document.getElementById('hostForm');
            const createRoomButton = document.getElementById('createRoom');
            const roomNameInput = document.getElementById('roomName');
            const searchInput = document.getElementById('searchInput');
            const roomLinksDiv = document.getElementById('roomLinks');

            hostButton.addEventListener('click', function() {
                hostForm.classList.toggle('hidden');
            });

            createRoomButton.addEventListener('click', function() {
                const roomName = roomNameInput.value.trim();
                if (roomName) {
                    addRoom(roomName);
                    roomNameInput.value = '';
                }
            });

            searchInput.addEventListener('input', function() {
                updateSearch();
            });

            function loadRooms() {
                db.collection("rooms").get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        createRoomLink(doc.data().name);
                    });
                    updateSearch();
                });
            }

            function addRoom(roomName) {
                db.collection("rooms").add({ name: roomName }).then((docRef) => {
                    createRoomLink(roomName);
                    updateSearch();
                });
            }

            function createRoomLink(roomName) {
                const roomLink = document.createElement('a');
                roomLink.href = `room.html?room=${encodeURIComponent(roomName)}`;
                roomLink.className = 'roomLink';
                roomLink.textContent = `채팅방: ${roomName}`;
                roomLinksDiv.appendChild(roomLink);
                roomLinksDiv.appendChild(document.createElement('br'));
            }

            function updateSearch() {
                const searchQuery = searchInput.value.toLowerCase();
                document.querySelectorAll('.roomLink').forEach(link => {
                    const roomName = link.textContent.toLowerCase();
                    if (roomName.includes(searchQuery)) {
                        link.style.display = '';
                    } else {
                        link.style.display = 'none';
                    }
                });
            }

            loadRooms();
        });
    </script>
</body>
</html>
